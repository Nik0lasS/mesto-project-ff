(()=>{"use strict";var e=document.querySelector(".content").querySelector(".profile"),t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-20",headers:{authorization:"b2f588d9-1718-4c54-bf0c-460d107d7029","Content-Type":"application/json"}};function n(e){var n;n=e.target.closest(".card")._id,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),e.target.closest(".card").remove()}function o(e){e.target.classList.toggle("card__like-button_is-active");var n,o=e.target.closest(".card").querySelector(".card__like-counter");e.target.classList.contains("card__like-button_is-active")?(n=e.target.closest(".card")._id,fetch("".concat(t.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){o.textContent=e.likes.length})):function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e.target.closest(".card")._id).then((function(e){o.textContent=e.likes.length}))}var r=function(){document.querySelector(".popup_is-opened").classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)},c=function(e){"Escape"===e.key&&r()},a=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)},u=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__input_error_active"),n.textContent=""},i=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("form__submit_inactive"),t.disabled=!1):(t.classList.add("form__submit_inactive"),t.disabled=!0)},s=function(e){var t=Array.from(e.querySelectorAll(".popup__input"));t.forEach((function(t){u(e,t)})),i(t,e.querySelector(".popup__button"))},l=document.querySelector(".profile"),p=document.querySelector(".places__list"),d=document.querySelector(".popup_type_image"),_=d.querySelector(".popup__image"),f=d.querySelector(".popup__caption"),m=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),v=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_user_avatar"),b=document.forms.editAvatar,q=l.querySelector(".profile__image"),k=S.querySelector(".popup__input_type_user_avatar"),g=document.forms.editProfile,L={name:g.querySelector(".popup__input_type_name"),about:g.querySelector(".popup__input_type_description")},C={name:l.querySelector(".profile__title"),about:l.querySelector(".profile__description")},E=document.forms.newPlace,x={name:E.querySelector(".popup__input_type_card-name"),link:E.querySelector(".popup__input_type_url")};function j(e){_.src=e.target.src,_.alt=e.target.alt,f.textContent=e.target.alt,a(d)}document.getElementById("popupsContainer").addEventListener("click",(function(e){var t=e.target.classList;(t.contains("popup_is-opened")||t.contains("popup__close"))&&r()})),m.addEventListener("click",(function(){a(v),L.about.value=C.about.textContent,L.name.value=C.name.textContent,s(g)})),y.addEventListener("click",(function(){a(h)})),q.addEventListener("click",(function(){a(S)})),b.addEventListener("submit",(function(e){var n;e.preventDefault(),b.querySelector(".popup__button").textContent="Сохранение...",(n=k.value,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).catch((function(e){console.log(e)})),b.querySelector(".popup__button").textContent="Сохранить",r(),s(g)})),g.addEventListener("submit",(function(e){var n;e.preventDefault(),g.querySelector(".popup__button").textContent="Сохранение...",C.name.textContent=L.name.value,C.about.textContent=L.about.value,(n=L,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:n.name.value,about:n.about.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).catch((function(e){console.log(e)})),g.querySelector(".popup__button").textContent="Сохранить",r()})),E.addEventListener("submit",(function(e){e.preventDefault(),E.querySelector(".popup__button").textContent="Сохранение...";var n,o={name:"",link:""};o.name=x.name.value,o.link=x.link.value,(n=o,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:n.name,link:n.link})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).catch((function(e){console.log(e)})),E.reset(),E.querySelector(".popup__button").textContent="Сохранить",r(),s(E)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");i(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n,o.classList.add("popup__input_error_active")}(e,t,t.validationMessage)}(e,o),i(t,n)}))}))}(e)})),fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){var n;n=t,e.querySelector(".profile__title").textContent=n.name,e.querySelector(".profile__description").textContent=n.about,e.querySelector(".profile__image").style="background-image: url(".concat(n.avatar,");")})).catch((function(e){console.log(e)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=function(e,t,n,o){var r=document.querySelector("#card-template").content.cloneNode(!0),c=r.querySelector(".card__delete-button"),a=r.querySelector(".card__like-button"),u=r.querySelector(".card__image"),i=r.querySelector(".card__like-counter"),s=e.owner._id,l="df0af4163426169488ebfcd5",p=r.querySelector(".card");return r.querySelector(".card__title").textContent=e.name,u.src=e.link,u.alt=e.name,p._id=e._id,s!==l&&(c.style.display="none"),i.textContent=e.likes.length,e.likes.some((function(e){return e._id===l}))&&a.classList.add("card__like-button_is-active"),c.addEventListener("click",t),a.addEventListener("click",n),u.addEventListener("click",o),r}(e,n,o,j);p.append(t)}))})).catch((function(e){console.log(e)})),console.log(document.querySelector(".popup__button").textContent)})();