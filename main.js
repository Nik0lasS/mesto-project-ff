(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-20",headers:{authorization:"b2f588d9-1718-4c54-bf0c-460d107d7029","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function n(e,t,n,o,r){var c=document.querySelector("#card-template").content.cloneNode(!0),a=c.querySelector(".card__delete-button"),i=c.querySelector(".card__like-button"),u=c.querySelector(".card__image"),l=c.querySelector(".card__like-counter"),s=e.owner._id,d=c.querySelector(".card");return c.querySelector(".card__title").textContent=e.name,u.src=e.link,u.alt=e.name,d._id=e._id,s!==r&&(a.style.display="none"),l.textContent=e.likes.length,e.likes.some((function(e){return e._id===r}))&&i.classList.add("card__like-button_is-active"),a.addEventListener("click",t),i.addEventListener("click",n),u.addEventListener("click",o),c}function o(n){var o;(o=n.target.closest(".card")._id,fetch("".concat(e.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))).then((function(){n.target.closest(".card").remove()})).catch((function(e){console.log(e)}))}function r(n){var o,r=n.target.closest(".card").querySelector(".card__like-counter");n.target.classList.contains("card__like-button_is-active")?(o=n.target.closest(".card")._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))).then((function(e){r.textContent=e.likes.length,n.target.classList.toggle("card__like-button_is-active")})):function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e)}))}(n.target.closest(".card")._id).then((function(e){r.textContent=e.likes.length,n.target.classList.toggle("card__like-button_is-active")}))}var c=function(){document.querySelector(".popup_is-opened").classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)},a=function(e){"Escape"===e.key&&c()},i=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",a)},u=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),t.setCustomValidity(""),o.classList.remove(n.errorClass),o.textContent=""},l=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)},s=function(e,t){var n=Array.from(e.querySelectorAll(t.inputElement));n.forEach((function(n){u(e,n,t)})),l(n,e.querySelector(t.buttonElement),t)},d=document.querySelector(".profile"),p=document.querySelector(".places__list"),_=document.querySelector(".popup_type_image"),f=_.querySelector(".popup__image"),m=_.querySelector(".popup__caption"),y=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_user_avatar"),q=document.forms.editAvatar,g=d.querySelector(".profile__image"),E=S.querySelector(".popup__input_type_user_avatar"),C=document.forms.editProfile,k={name:C.querySelector(".popup__input_type_name"),about:C.querySelector(".popup__input_type_description")},L={name:d.querySelector(".profile__title"),about:d.querySelector(".profile__description")},x=document.forms.newPlace,U={name:x.querySelector(".popup__input_type_card-name"),link:x.querySelector(".popup__input_type_url")},A="";function w(e){f.src=e.target.src,f.alt=e.target.alt,m.textContent=e.target.alt,i(_)}document.getElementById("popupsContainer").addEventListener("click",(function(e){var t=e.target.classList;(t.contains("popup_is-opened")||t.contains("popup__close"))&&c()})),y.addEventListener("click",(function(){i(h),k.about.value=L.about.textContent,k.name.value=L.name.textContent,s(C,P)})),v.addEventListener("click",(function(){i(b)})),g.addEventListener("click",(function(){i(S)})),q.addEventListener("submit",(function(n){var o;n.preventDefault(),q.querySelector(".popup__button").textContent="Сохранение...",(o=E.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return t(e)}))).then((function(){c(),d.querySelector(".profile__image").style="background-image: url(".concat(E.value,");")})).catch((function(e){console.log(e)})).finally((function(){q.querySelector(".popup__button").textContent="Сохранить"}))})),C.addEventListener("submit",(function(n){var o;n.preventDefault(),C.querySelector(".popup__button").textContent="Сохранение...",(o=k,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o.name.value,about:o.about.value})}).then((function(e){return t(e)}))).then((function(){L.name.textContent=k.name.value,L.about.textContent=k.about.value,c()})).catch((function(e){console.log(e)})).finally((function(){C.querySelector(".popup__button").textContent="Сохранить"}))})),x.addEventListener("submit",(function(a){a.preventDefault(),x.querySelector(".popup__button").textContent="Сохранение...";var i,u={name:"",link:"",owner:{_id:""},likes:[],_id:""};u.name=U.name.value,u.link=U.link.value,u.owner._id=A,(i=u,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:i.name,link:i.link})}).then((function(e){return t(e)}))).then((function(e){u._id=e._id;var t=n(u,o,r,w,A);p.prepend(t),x.reset(),c(),s(x,P)})).catch((function(e){console.log(e)})).finally((function(){x.querySelector(".popup__button").textContent="Сохранить"}))}));var P={formElement:".popup__form",inputElement:".popup__input",buttonElement:".popup__button",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error_active"};!function(e){Array.from(document.querySelectorAll(e.formElement)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputElement)),o=e.querySelector(t.buttonElement);l(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),l(n,o,t)}))}))}(t,e)}))}(P),Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return t(e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return t(e)}))]).then((function(e){var t=e[0],c=e[1];!function(e){d.querySelector(".profile__title").textContent=e.name,d.querySelector(".profile__description").textContent=e.about,d.querySelector(".profile__image").style="background-image: url(".concat(e.avatar,");")}(t),A=t._id,c.forEach((function(e){var t=n(e,o,r,w,A);p.append(t)}))})).catch((function(e){console.log(e)}))})();